<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerenciador de Tarefas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<style>
    
   


</style>
<body class="bg-light" style="color: #ADD8E6;">
  <div class="container py-4">
    <h1 class="text-center text-white bg-primary p-3 rounded">Seu condomínio</h1>

    <div class="text-end my-3">
      <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalNovaTarefa">
        <i class="fa fa-plus-circle"></i> Nova Tarefa
      </button>
    </div>

   
    <% tarefas.forEach(tarefa => { %>
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fa fa-tasks text-primary"></i> <%= tarefa.nome %></h5>
            <div>
              <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modalEditar<%= tarefa.id %>">
                <i class="fa fa-edit"></i>
              </button>
              <form action="/tarefas/<%= tarefa.id %>/excluir" method="POST" class="d-inline">
                <button class="btn btn-danger btn-sm" onclick="return confirm('Deseja excluir esta tarefa?')">
                  <i class="fa fa-trash"></i>
                </button>
              </form>
            </div>
          </div>
          <p class="mt-2"><b>Início:</b> <%= tarefa.inicio %> | <b>Fim:</b> <%= tarefa.conclusao %></p>
          <p><b>Custo:</b> R$ <%= tarefa.custo %> | <b>Status:</b> <span class="badge bg-info"><%= tarefa.status %></span></p>

          <h6><i class="fa fa-comments text-info"></i> Comentários</h6>
          <% comentarios.filter(c => c.tarefa_id === tarefa.id).forEach(coment => { %>
            <div class="alert alert-secondary py-1 px-2"><%= coment.texto %></div>
          <% }) %>
          <form action="/tarefas/<%= tarefa.id %>/comentarios" method="POST" class="input-group mt-2">
            <input class="form-control" name="texto" placeholder="comentários..." required>
            <button class="btn btn-success"><i class="fa fa-plus"></i></button>
          </form>
        </div>
      </div>

      
      <div class="modal fade" id="modalEditar<%= tarefa.id %>" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
              <h5 class="modal-title">Editar Tarefa</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <form action="/tarefas/<%= tarefa.id %>/editar" method="POST" class="row g-2">
                <div class="col-12"><input class="form-control" name="nome" value="<%= tarefa.nome %>" required></div>
                <div class="col-6"><input class="form-control" type="date" name="inicio" value="<%= tarefa.inicio %>" required></div>
                <div class="col-6"><input class="form-control" type="date" name="conclusao" value="<%= tarefa.conclusao %>" required></div>
                <div class="col-6"><input class="form-control" name="custo" value="<%= tarefa.custo %>" required></div>
                <div class="col-6">
                  <select class="form-select" name="status">
                    <option <%= tarefa.status=="Pendente"?"selected":"" %>>Pendente</option>
                    <option <%= tarefa.status=="Em andamento"?"selected":"" %>>Em andamento</option>
                    <option <%= tarefa.status=="Concluído"?"selected":"" %>>Concluído</option>
                  </select>
                </div>
                <div class="col-12 text-end">
                  <button class="btn btn-primary"><i class="fa fa-save"></i> Salvar</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    <% }) %>
  </div>


  <div class="modal fade" id="modalNovaTarefa" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">Nova Tarefa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form action="/tarefas" method="POST" class="row g-2">
            <div class="col-12"><input class="form-control" name="nome" placeholder="Nome da tarefa" required></div>
            <div class="col-6"><input class="form-control" type="date" name="inicio" required></div>
            <div class="col-6"><input class="form-control" type="date" name="conclusao" required></div>
            <div class="col-6"><input class="form-control" name="custo" placeholder="Custo R$" required></div>
            <div class="col-6">
              <select class="form-select" name="status" required>
                <option value="Pendente">Pendente</option>
                <option value="Em andamento">Em andamento</option>
                <option value="Concluído">Concluído</option>
              </select>
            </div>
            <div class="col-12 text-end">
              <button class="btn btn-primary"><i class="fa fa-save"></i> Salvar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
